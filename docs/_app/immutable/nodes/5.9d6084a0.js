import{s as Ce,y as ie,M as ge,N as _e,h as R,d as p,j as y,O as he,i as C,A as k,B as M,L as ee,F as Pe,G as we,H as ve,I as N,a as H,f as L,U as Se,c as j,g as F,o as Le,Q as Te,l as O,m as U,e as be,n as ce}from"../chunks/scheduler.729d8167.js";import{S as Ve,i as Ae,t as I,c as se,a as D,g as re,b as q,d as x,m as K,e as Y}from"../chunks/index.fba99ec1.js";import{p as Fe,f as oe}from"../chunks/index.25eabe26.js";import{L as Re}from"../chunks/Loader.3142fb0b.js";import{a as G}from"../chunks/snackbar.55a9a3ca.js";import"../chunks/singletons.c518ef07.js";import{p as le}from"../chunks/index.a8881894.js";import{v as Oe,p as Ue,B as W}from"../chunks/misc.3ba06c93.js";import{t as ke,g as ze}from"../chunks/db.60763777.js";import{P as Me,a as Be}from"../chunks/P.0c6bcb21.js";function Ne(l){let e,t,o,n,s,a=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"currentColor"},l[4],{class:o=ke("shrink-0",l[3][l[0]],l[5].class)},{role:l[1]},{"aria-label":l[2]},{viewBox:"0 0 18 19"}],c={};for(let r=0;r<a.length;r+=1)c=ie(c,a[r]);return{c(){e=ge("svg"),t=ge("path"),this.h()},l(r){e=_e(r,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var i=R(e);t=_e(i,"path",{fill:!0,"fill-rule":!0,d:!0,"clip-rule":!0}),R(t).forEach(p),i.forEach(p),this.h()},h(){y(t,"fill","currentColor"),y(t,"fill-rule","evenodd"),y(t,"d","M8.842 18.083A8.8 8.8 0 0 1 .193 9.135a8.841 8.841 0 0 1 8.8-8.652h.152a8.464 8.464 0 0 1 5.7 2.257l-2.193 2.038A5.27 5.27 0 0 0 9.091 3.4a5.882 5.882 0 0 0-.2 11.761h.124a5.091 5.091 0 0 0 5.248-4.058L14.3 11H9V8h8.341c.065.543.094 1.09.087 1.636-.086 5.053-3.463 8.449-8.4 8.449l-.186-.002Z"),y(t,"clip-rule","evenodd"),he(e,c)},m(r,i){C(r,e,i),k(e,t),n||(s=[M(e,"click",l[6]),M(e,"keydown",l[7]),M(e,"keyup",l[8]),M(e,"focus",l[9]),M(e,"blur",l[10]),M(e,"mouseenter",l[11]),M(e,"mouseleave",l[12]),M(e,"mouseover",l[13]),M(e,"mouseout",l[14])],n=!0)},p(r,[i]){he(e,c=ze(a,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"currentColor"},i&16&&r[4],i&33&&o!==(o=ke("shrink-0",r[3][r[0]],r[5].class))&&{class:o},i&2&&{role:r[1]},i&4&&{"aria-label":r[2]},{viewBox:"0 0 18 19"}]))},i:ee,o:ee,d(r){r&&p(e),n=!1,Pe(s)}}}function Ge(l,e,t){const o=["size","role","ariaLabel"];let n=we(e,o),{size:s="md"}=e,{role:a="img"}=e;const c={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{ariaLabel:r="google solid"}=e;function i(u){N.call(this,l,u)}function m(u){N.call(this,l,u)}function f(u){N.call(this,l,u)}function w(u){N.call(this,l,u)}function T(u){N.call(this,l,u)}function $(u){N.call(this,l,u)}function V(u){N.call(this,l,u)}function J(u){N.call(this,l,u)}function Q(u){N.call(this,l,u)}return l.$$set=u=>{t(5,e=ie(ie({},e),ve(u))),t(4,n=we(e,o)),"size"in u&&t(0,s=u.size),"role"in u&&t(1,a=u.role),"ariaLabel"in u&&t(2,r=u.ariaLabel)},e=ve(e),[s,a,r,c,n,e,i,m,f,w,T,$,V,J,Q]}class He extends Ve{constructor(e){super(),Ae(this,e,Ge,Ne,Ce,{size:0,role:1,ariaLabel:2})}}const je="https://www.googleapis.com/upload/drive/v3/files";async function De({accessToken:l,fileId:e,localStorageId:t,metadata:o,type:n}){const s=localStorage.getItem(t)||"",a=new Blob([s],{type:n}),c=new FormData;return c.append("resource",new Blob([JSON.stringify(o)],{type:n})),c.append("file",a),await(await fetch(`${je}${e?`/${e}`:""}?uploadType=multipart`,{method:e?"PATCH":"POST",headers:new Headers({Authorization:"Bearer "+l}),body:c})).json()}function qe(l){let e,t,o,n,s,a,c="Connect to Google Drive",r,i,m;return n=new He({props:{size:"lg"}}),{c(){e=L("div"),t=L("button"),o=L("div"),q(n.$$.fragment),s=H(),a=L("h2"),a.textContent=c,this.h()},l(f){e=F(f,"DIV",{class:!0});var w=R(e);t=F(w,"BUTTON",{class:!0});var T=R(t);o=F(T,"DIV",{class:!0});var $=R(o);x(n.$$.fragment,$),s=j($),a=F($,"H2",{class:!0,"data-svelte-h":!0}),Te(a)!=="svelte-1b9un9c"&&(a.textContent=c),$.forEach(p),T.forEach(p),w.forEach(p),this.h()},h(){y(a,"class","text-lg"),y(o,"class","flex sm:flex-row flex-col gap-2 items-center justify-center"),y(t,"class","w-full border rounded-lg border-slate-600 p-10 border-opacity-50 hover:bg-slate-800 max-w-3xl"),y(e,"class","flex justify-center pt-0 sm:pt-32")},m(f,w){C(f,e,w),k(e,t),k(t,o),K(n,o,null),k(o,s),k(o,a),r=!0,i||(m=M(t,"click",l[7]),i=!0)},p:ee,i(f){r||(D(n.$$.fragment,f),r=!0)},o(f){I(n.$$.fragment,f),r=!1},d(f){f&&p(e),Y(n),i=!1,m()}}}function xe(l){let e,t,o="Google Drive:",n,s,a,c,r,i,m,f,w,T,$,V,J,Q,u,S,Z,X;w=new W({props:{color:"blue",$$slots:{default:[Ye]},$$scope:{ctx:l}}}),w.$on("click",l[8]),V=new W({props:{color:"dark",$$slots:{default:[Je]},$$scope:{ctx:l}}}),V.$on("click",l[13]);let h=l[3]&&$e(l);S=new W({props:{color:"dark",$$slots:{default:[Xe]},$$scope:{ctx:l}}}),S.$on("click",l[15]);let v=l[4]&&Ee(l);return{c(){e=L("div"),t=L("h2"),t.textContent=o,n=H(),s=L("p"),a=O("Add your zipped manga files to the "),c=L("span"),r=O(ae),i=O(` folder\r
        in your Google Drive.`),m=H(),f=L("div"),q(w.$$.fragment),T=H(),$=L("div"),q(V.$$.fragment),J=H(),h&&h.c(),Q=H(),u=L("div"),q(S.$$.fragment),Z=H(),v&&v.c(),this.h()},l(_){e=F(_,"DIV",{class:!0});var b=R(e);t=F(b,"H2",{class:!0,"data-svelte-h":!0}),Te(t)!=="svelte-1dpf5jc"&&(t.textContent=o),n=j(b),s=F(b,"P",{class:!0});var B=R(s);a=U(B,"Add your zipped manga files to the "),c=F(B,"SPAN",{class:!0});var d=R(c);r=U(d,ae),d.forEach(p),i=U(B,` folder\r
        in your Google Drive.`),B.forEach(p),m=j(b),f=F(b,"DIV",{class:!0});var g=R(f);x(w.$$.fragment,g),T=j(g),$=F(g,"DIV",{class:!0});var E=R($);x(V.$$.fragment,E),J=j(E),h&&h.l(E),E.forEach(p),Q=j(g),u=F(g,"DIV",{class:!0});var z=R(u);x(S.$$.fragment,z),Z=j(z),v&&v.l(z),z.forEach(p),g.forEach(p),b.forEach(p),this.h()},h(){y(t,"class","text-3xl font-semibold text-center pt-2"),y(c,"class","text-primary-700"),y(s,"class","text-center"),y($,"class","flex-col gap-2 flex"),y(u,"class","flex-col gap-2 flex"),y(f,"class","flex flex-col gap-4 w-full max-w-3xl"),y(e,"class","flex justify-between items-center gap-6 flex-col")},m(_,b){C(_,e,b),k(e,t),k(e,n),k(e,s),k(s,a),k(s,c),k(c,r),k(s,i),k(e,m),k(e,f),K(w,f,null),k(f,T),k(f,$),K(V,$,null),k($,J),h&&h.m($,null),k(f,Q),k(f,u),K(S,u,null),k(u,Z),v&&v.m(u,null),X=!0},p(_,b){const B={};b&16777216&&(B.$$scope={dirty:b,ctx:_}),w.$set(B);const d={};b&16777216&&(d.$$scope={dirty:b,ctx:_}),V.$set(d),_[3]?h?(h.p(_,b),b&8&&D(h,1)):(h=$e(_),h.c(),D(h,1),h.m($,null)):h&&(re(),I(h,1,1,()=>{h=null}),se());const g={};b&16777216&&(g.$$scope={dirty:b,ctx:_}),S.$set(g),_[4]?v?(v.p(_,b),b&16&&D(v,1)):(v=Ee(_),v.c(),D(v,1),v.m(u,null)):v&&(re(),I(v,1,1,()=>{v=null}),se())},i(_){X||(D(w.$$.fragment,_),D(V.$$.fragment,_),D(h),D(S.$$.fragment,_),D(v),X=!0)},o(_){I(w.$$.fragment,_),I(V.$$.fragment,_),I(h),I(S.$$.fragment,_),I(v),X=!1},d(_){_&&p(e),Y(w),Y(V),h&&h.d(),Y(S),v&&v.d()}}}function Ke(l){let e,t;return e=new Re({props:{$$slots:{default:[ot]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment)},l(o){x(e.$$.fragment,o)},m(o,n){K(e,o,n),t=!0},p(o,n){const s={};n&16777315&&(s.$$scope={dirty:n,ctx:o}),e.$set(s)},i(o){t||(D(e.$$.fragment,o),t=!0)},o(o){I(e.$$.fragment,o),t=!1},d(o){Y(e,o)}}}function Ye(l){let e;return{c(){e=O("Download manga")},l(t){e=U(t,"Download manga")},m(t,o){C(t,e,o)},d(t){t&&p(e)}}}function Je(l){let e;return{c(){e=O("Upload volume data")},l(t){e=U(t,"Upload volume data")},m(t,o){C(t,e,o)},d(t){t&&p(e)}}}function $e(l){let e,t;return e=new W({props:{color:"alternative",$$slots:{default:[Qe]},$$scope:{ctx:l}}}),e.$on("click",l[14]),{c(){q(e.$$.fragment)},l(o){x(e.$$.fragment,o)},m(o,n){K(e,o,n),t=!0},p(o,n){const s={};n&16777216&&(s.$$scope={dirty:n,ctx:o}),e.$set(s)},i(o){t||(D(e.$$.fragment,o),t=!0)},o(o){I(e.$$.fragment,o),t=!1},d(o){Y(e,o)}}}function Qe(l){let e;return{c(){e=O("Download volume data")},l(t){e=U(t,"Download volume data")},m(t,o){C(t,e,o)},d(t){t&&p(e)}}}function Xe(l){let e;return{c(){e=O("Upload profiles")},l(t){e=U(t,"Upload profiles")},m(t,o){C(t,e,o)},d(t){t&&p(e)}}}function Ee(l){let e,t;return e=new W({props:{color:"alternative",$$slots:{default:[Ze]},$$scope:{ctx:l}}}),e.$on("click",l[16]),{c(){q(e.$$.fragment)},l(o){x(e.$$.fragment,o)},m(o,n){K(e,o,n),t=!0},p(o,n){const s={};n&16777216&&(s.$$scope={dirty:n,ctx:o}),e.$set(s)},i(o){t||(D(e.$$.fragment,o),t=!0)},o(o){I(e.$$.fragment,o),t=!1},d(o){Y(e,o)}}}function Ze(l){let e;return{c(){e=O("Download profiles")},l(t){e=U(t,"Download profiles")},m(t,o){C(t,e,o)},d(t){t&&p(e)}}}function We(l){let e;return{c(){e=O(l[5])},l(t){e=U(t,l[5])},m(t,o){C(t,e,o)},p(t,o){o&32&&ce(e,t[5])},i:ee,o:ee,d(t){t&&p(e)}}}function et(l){let e,t,o,n;return e=new Me({props:{$$slots:{default:[tt]},$$scope:{ctx:l}}}),o=new Be({props:{progress:l[6]}}),{c(){q(e.$$.fragment),t=H(),q(o.$$.fragment)},l(s){x(e.$$.fragment,s),t=j(s),x(o.$$.fragment,s)},m(s,a){K(e,s,a),C(s,t,a),K(o,s,a),n=!0},p(s,a){const c={};a&16777219&&(c.$$scope={dirty:a,ctx:s}),e.$set(c);const r={};a&64&&(r.progress=s[6]),o.$set(r)},i(s){n||(D(e.$$.fragment,s),D(o.$$.fragment,s),n=!0)},o(s){I(e.$$.fragment,s),I(o.$$.fragment,s),n=!1},d(s){s&&p(t),Y(e,s),Y(o,s)}}}function tt(l){let e=oe(l[0])+"",t,o,n=oe(l[1])+"",s;return{c(){t=O(e),o=O(" / "),s=O(n)},l(a){t=U(a,e),o=U(a," / "),s=U(a,n)},m(a,c){C(a,t,c),C(a,o,c),C(a,s,c)},p(a,c){c&1&&e!==(e=oe(a[0])+"")&&ce(t,e),c&2&&n!==(n=oe(a[1])+"")&&ce(s,n)},d(a){a&&(p(t),p(o),p(s))}}}function ot(l){let e,t,o,n;const s=[et,We],a=[];function c(r,i){return r[0]>0?0:1}return e=c(l),t=a[e]=s[e](l),{c(){t.c(),o=be()},l(r){t.l(r),o=be()},m(r,i){a[e].m(r,i),C(r,o,i),n=!0},p(r,i){let m=e;e=c(r),e===m?a[e].p(r,i):(re(),I(a[m],1,1,()=>{a[m]=null}),se(),t=a[e],t?t.p(r,i):(t=a[e]=s[e](r),t.c()),D(t,1),t.m(o.parentNode,o))},i(r){n||(D(t),n=!0)},o(r){I(t),n=!1},d(r){r&&p(o),a[e].d(r)}}}function lt(l){let e,t,o,n,s;const a=[Ke,xe,qe],c=[];function r(i,m){return i[5]||i[0]>0?0:i[2]?1:2}return o=r(l),n=c[o]=a[o](l),{c(){e=H(),t=L("div"),n.c(),this.h()},l(i){Se("svelte-vx7v1c",document.head).forEach(p),e=j(i),t=F(i,"DIV",{class:!0});var f=R(t);n.l(f),f.forEach(p),this.h()},h(){document.title="Cloud",y(t,"class","p-2 h-[90svh]")},m(i,m){C(i,e,m),C(i,t,m),c[o].m(t,null),s=!0},p(i,[m]){let f=o;o=r(i),o===f?c[o].p(i,m):(re(),I(c[f],1,1,()=>{c[f]=null}),se(),n=c[o],n?n.p(i,m):(n=c[o]=a[o](i),n.c()),D(n,1),n.m(t,null))},i(i){s||(D(n),s=!0)},o(i){I(n),s=!1},d(i){i&&(p(e),p(t)),c[o].d()}}}const nt="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",st="https://www.googleapis.com/auth/drive.file",rt="application/vnd.google-apps.folder",ae="mokuro-reader",Ie="volume-data.json",ye="profiles.json",ne="application/json";function at(l,e,t){let o;const n={}.VITE_GDRIVE_CLIENT_ID,s={}.VITE_GDRIVE_API_KEY;let a,c="",r="",i="",m="",f="",w=0,T=0;function $(d){return new Promise((g,E)=>{const{access_token:z}=gapi.auth.getToken(),A=new XMLHttpRequest;t(0,w=0),t(1,T=0),A.open("GET",`https://www.googleapis.com/drive/v3/files/${d}?alt=media`),A.setRequestHeader("Authorization",`Bearer ${z}`),A.responseType="blob",A.onprogress=({loaded:P,total:te})=>{t(5,f=""),t(0,w=P),t(1,T=te)},A.onabort=P=>{console.warn(`xhr ${d}: download aborted at ${P.loaded} of ${P.total}`),G("Download failed"),E(new Error("Download aborted"))},A.onerror=P=>{console.error(`xhr ${d}: download error at ${P.loaded} of ${P.total}`),G("Download failed"),E(new Error("Error downloading file"))},A.onload=()=>{t(0,w=0),t(1,T=0),g(A.response)},A.ontimeout=P=>{console.warn(`xhr ${d}: download timeout after ${P.loaded} of ${P.total}`),G("Download timed out"),E(new Error("Timout downloading file"))},A.send()})}async function V(d){var A,P,te,fe,ue,de,pe;if((d==null?void 0:d.error)!==void 0)throw d;t(2,c=d==null?void 0:d.access_token),t(5,f="Connecting to drive");const{result:g}=await gapi.client.drive.files.list({q:`mimeType='application/vnd.google-apps.folder' and name='${ae}'`,fields:"files(id)"});if(((A=g.files)==null?void 0:A.length)===0){const{result:me}=await gapi.client.drive.files.create({resource:{mimeType:rt,name:ae},fields:"id"});r=me.id||""}else r=((te=(P=g.files)==null?void 0:P[0])==null?void 0:te.id)||""||"";const{result:E}=await gapi.client.drive.files.list({q:`'${r}' in parents and name='${Ie}'`,fields:"files(id, name)"});((fe=E.files)==null?void 0:fe.length)!==0&&t(3,i=((ue=E.files)==null?void 0:ue[0].id)||"");const{result:z}=await gapi.client.drive.files.list({q:`'${r}' in parents and name='${ye}'`,fields:"files(id, name)"});((de=z.files)==null?void 0:de.length)!==0&&t(4,m=((pe=z.files)==null?void 0:pe[0].id)||""),t(5,f=""),c&&G("Connected to Google Drive")}function J(){gapi.client.getToken()===null?a.requestAccessToken({prompt:"consent"}):a.requestAccessToken({prompt:""})}Le(()=>{gapi.load("client",async()=>{await gapi.client.init({apiKey:s,discoveryDocs:[nt]})}),gapi.load("picker",()=>{}),a=google.accounts.oauth2.initTokenClient({client_id:n,scope:st,callback:V})});function Q(){const d=new google.picker.DocsView(google.picker.ViewId.DOCS).setMimeTypes("application/zip,application/x-zip-compressed").setMode(google.picker.DocsViewMode.LIST).setIncludeFolders(!0).setParent(r);new google.picker.PickerBuilder().addView(d).setOAuthToken(c).setAppId(n).setDeveloperKey(s).enableFeature(google.picker.Feature.NAV_HIDDEN).setCallback(u).build().setVisible(!0)}async function u(d){try{if(d[google.picker.Response.ACTION]==google.picker.Action.PICKED){t(5,f="Downloading from drive...");const g=d[google.picker.Response.DOCUMENTS],E=await $(g[0].id);t(5,f="Adding to catalog...");const z=new File([E],g[0].name);await Fe([z]),t(5,f="")}}catch(g){G("Something went wrong"),t(5,f=""),console.error(g)}}async function S(){const d={mimeType:ne,name:Ie,parents:[i?null:r]};t(5,f="Uploading volume data");const g=await De({accessToken:c,fileId:i,metadata:d,localStorageId:"volumes",type:ne});t(3,i=g.id),t(5,f=""),i&&G("Volume data uploaded")}async function Z(){const d={mimeType:ne,name:ye,parents:[m?null:r]};t(5,f="Uploading profiles");const g=await De({accessToken:c,fileId:m,metadata:d,localStorageId:"profiles",type:ne});t(4,m=g.id),t(5,f=""),m&&G("Profiles uploaded")}async function X(){t(5,f="Downloading volume data");const{body:d}=await gapi.client.drive.files.get({fileId:i,alt:"media"}),g=JSON.parse(d);Oe.update(E=>({...E,...g})),t(5,f=""),G("Volume data downloaded")}async function h(){t(5,f="Downloading profiles");const{body:d}=await gapi.client.drive.files.get({fileId:m,alt:"media"}),g=JSON.parse(d);Ue.update(E=>({...E,...g})),t(5,f=""),G("Profiles downloaded")}const v=()=>le("Upload volume data?",S),_=()=>le("Download and overwrite volume data?",X),b=()=>le("Upload profiles?",Z),B=()=>le("Download and overwrite profiles?",h);return l.$$.update=()=>{l.$$.dirty&3&&t(6,o=Math.floor(w/T*100).toString())},[w,T,c,i,m,f,o,J,Q,S,Z,X,h,v,_,b,B]}class wt extends Ve{constructor(e){super(),Ae(this,e,at,lt,Ce,{})}}export{wt as component};
