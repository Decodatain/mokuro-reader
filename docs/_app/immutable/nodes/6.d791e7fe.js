import{s as q,f as V,g as z,h as G,d as i,i as l,R as H,o as J,l as _,a as A,e as D,m as h,c as C,n as d}from"../chunks/scheduler.729d8167.js";import{S as K,i as Q,b as k,d as P,m as S,a as c,t as u,e as R,g as W,c as X}from"../chunks/index.fba99ec1.js";import{g as I}from"../chunks/navigation.f65766f8.js";import{p as Y}from"../chunks/stores.eba2874c.js";import{L as Z}from"../chunks/Loader.3142fb0b.js";import{p as x}from"../chunks/index.49308068.js";import{a as ee}from"../chunks/snackbar.24c7c16b.js";import{p as te}from"../chunks/index.82e508c7.js";import"../chunks/db.60763777.js";import{P as oe,a as se}from"../chunks/P.0c6bcb21.js";function re(n){return[...new DOMParser().parseFromString(n,"text/html").getElementsByTagName("a")]}function j(n){let s,r,a,t;return s=new oe({props:{$$slots:{default:[ae]},$$scope:{ctx:n}}}),a=new se({props:{progress:n[3]}}),{c(){k(s.$$.fragment),r=A(),k(a.$$.fragment)},l(e){P(s.$$.fragment,e),r=C(e),P(a.$$.fragment,e)},m(e,o){S(s,e,o),l(e,r,o),S(a,e,o),t=!0},p(e,o){const m={};o&4099&&(m.$$scope={dirty:o,ctx:e}),s.$set(m);const p={};o&8&&(p.progress=e[3]),a.$set(p)},i(e){t||(c(s.$$.fragment,e),c(a.$$.fragment,e),t=!0)},o(e){u(s.$$.fragment,e),u(a.$$.fragment,e),t=!1},d(e){e&&i(r),R(s,e),R(a,e)}}}function ae(n){let s,r,a;return{c(){s=_(n[0]),r=_(" / "),a=_(n[1])},l(t){s=h(t,n[0]),r=h(t," / "),a=h(t,n[1])},m(t,e){l(t,s,e),l(t,r,e),l(t,a,e)},p(t,e){e&1&&d(s,t[0]),e&2&&d(a,t[1])},d(t){t&&(i(s),i(r),i(a))}}}function ne(n){let s,r,a,t,e=n[0]&&n[3]!=="100"&&j(n);return{c(){s=_(n[2]),r=A(),e&&e.c(),a=D()},l(o){s=h(o,n[2]),r=C(o),e&&e.l(o),a=D()},m(o,m){l(o,s,m),l(o,r,m),e&&e.m(o,m),l(o,a,m),t=!0},p(o,m){(!t||m&4)&&d(s,o[2]),o[0]&&o[3]!=="100"?e?(e.p(o,m),m&9&&c(e,1)):(e=j(o),e.c(),c(e,1),e.m(a.parentNode,a)):e&&(W(),u(e,1,1,()=>{e=null}),X())},i(o){t||(c(e),t=!0)},o(o){u(e),t=!1},d(o){o&&(i(s),i(r),i(a)),e&&e.d(o)}}}function me(n){let s,r,a;return r=new Z({props:{$$slots:{default:[ne]},$$scope:{ctx:n}}}),{c(){s=V("div"),k(r.$$.fragment)},l(t){s=z(t,"DIV",{});var e=G(s);P(r.$$.fragment,e),e.forEach(i)},m(t,e){l(t,s,e),S(r,s,null),a=!0},p(t,[e]){const o={};e&4111&&(o.$$scope={dirty:e,ctx:t}),r.$set(o)},i(t){a||(c(r.$$.fragment,t),a=!0)},o(t){u(r.$$.fragment,t),a=!1},d(t){t&&i(s),R(r)}}}function ie(n,s,r){let a,t;H(n,Y,v=>r(6,t=v));const e=t.url.searchParams.get("source")||"https://mokuro.moe/manga",o=t.url.searchParams.get("manga"),m=t.url.searchParams.get("volume"),p=`${e}/${o}/${m}`;let b="Loading...",f=[],g=0,w=0;async function U(){const E=await(await fetch(p+".mokuro",{cache:"no-store"})).blob(),F=new File([E],m+".mokuro",{type:E.type});Object.defineProperty(F,"webkitRelativePath",{value:"/"+m+".mokuro"});const M=await(await fetch(p+"/")).text(),y=re(M);r(2,b="Downloading images...");const O=[".jpg",".jpeg",".png",".webp"];r(1,w=y.length);for(const $ of y){const N=("."+$.pathname.split(".").at(-1)).toLowerCase();if(O.includes(N||"")){const T=await(await fetch(p+$.pathname)).blob(),B=new File([T],$.pathname.substring(1));Object.defineProperty(B,"webkitRelativePath",{value:"/"+m+$.pathname}),f.push(B)}r(0,g++,g)}f.push(F),f=f,r(2,b="Adding to catalog..."),x(f).then(()=>{I("/",{replaceState:!0})})}function L(){I("/",{replaceState:!0})}return J(()=>{!o||!m?(ee("Something went wrong"),L()):te(`Import ${decodeURI(m||"")} into catalog?`,U,L)}),n.$$.update=()=>{n.$$.dirty&3&&r(3,a=Math.floor(g/w*100).toString())},[g,w,b,a,e]}class ke extends K{constructor(s){super(),Q(this,s,ie,me,q,{BASE_URL:4})}get BASE_URL(){return this.$$.ctx[4]}}export{ke as component};
