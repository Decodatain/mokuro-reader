import{s as Ft,e as ft,i as Bt,d as Ie,G as dt,W as Sr,y as Re,H as mt,x as Tr,f as Cr,g as Er,h as Mr,ab as gt,B as j,C as Dr,D as _r,E as zr,F as Ar,I as H,Z as F}from"./scheduler.729d8167.js";import{S as Or,i as Fr,a as It,t as Rt}from"./index.fba99ec1.js";import{t as Br,g as Ir,u as Rr,d as Pr}from"./db.60763777.js";import{j as K,w as se}from"./singletons.883e71db.js";import{p as Pe}from"./stores.eba2874c.js";const Nr=!0,Pt=Nr;function Ae(t){let e,r,i,a,l,o;const d=t[10].default,m=Tr(d,t,t[9],null);let v=[{type:r=t[0]?void 0:t[1]},{href:t[0]},{role:i=t[0]?"link":"button"},t[3],{class:t[2]}],g={};for(let c=0;c<v.length;c+=1)g=Re(g,v[c]);return{c(){e=Cr(t[0]?"a":"button"),m&&m.c(),this.h()},l(c){e=Er(c,((t[0]?"a":"button")||"null").toUpperCase(),{type:!0,href:!0,role:!0,class:!0});var h=Mr(e);m&&m.l(h),h.forEach(Ie),this.h()},h(){gt(t[0]?"a":"button")(e,g)},m(c,h){Bt(c,e,h),m&&m.m(e,null),a=!0,l||(o=[j(e,"click",t[11]),j(e,"change",t[12]),j(e,"keydown",t[13]),j(e,"keyup",t[14]),j(e,"touchstart",t[15]),j(e,"touchend",t[16]),j(e,"touchcancel",t[17]),j(e,"mouseenter",t[18]),j(e,"mouseleave",t[19])],l=!0)},p(c,h){m&&m.p&&(!a||h&512)&&Dr(m,d,c,c[9],a?zr(d,c[9],h,null):_r(c[9]),null),gt(c[0]?"a":"button")(e,g=Ir(v,[(!a||h&3&&r!==(r=c[0]?void 0:c[1]))&&{type:r},(!a||h&1)&&{href:c[0]},(!a||h&1&&i!==(i=c[0]?"link":"button"))&&{role:i},h&8&&c[3],(!a||h&4)&&{class:c[2]}]))},i(c){a||(It(m,c),a=!0)},o(c){Rt(m,c),a=!1},d(c){c&&Ie(e),m&&m.d(c),l=!1,Ar(o)}}}function Zr(t){let e=t[0]?"a":"button",r,i,a=(t[0]?"a":"button")&&Ae(t);return{c(){a&&a.c(),r=ft()},l(l){a&&a.l(l),r=ft()},m(l,o){a&&a.m(l,o),Bt(l,r,o),i=!0},p(l,[o]){l[0],e?Ft(e,l[0]?"a":"button")?(a.d(1),a=Ae(l),e=l[0]?"a":"button",a.c(),a.m(r.parentNode,r)):a.p(l,o):(a=Ae(l),e=l[0]?"a":"button",a.c(),a.m(r.parentNode,r))},i(l){i||(It(a,l),i=!0)},o(l){Rt(a,l),i=!1},d(l){l&&Ie(r),a&&a.d(l)}}}function Lr(t,e,r){const i=["pill","outline","size","href","type","color","shadow"];let a=dt(e,i),{$$slots:l={},$$scope:o}=e;const d=Sr("group");let{pill:m=!1}=e,{outline:v=!1}=e,{size:g=d?"sm":"md"}=e,{href:c=void 0}=e,{type:h="button"}=e,{color:y=d?v?"dark":"alternative":"primary"}=e,{shadow:T=!1}=e;const C={alternative:"text-gray-900 bg-white border border-gray-200 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-400 hover:text-primary-700 focus:text-primary-700 dark:focus:text-white dark:hover:text-white",blue:"text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700",dark:"text-white bg-gray-800 hover:bg-gray-900 dark:bg-gray-800 dark:hover:bg-gray-700",green:"text-white bg-green-700 hover:bg-green-800 dark:bg-green-600 dark:hover:bg-green-700",light:"text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600",primary:"text-white bg-primary-700 hover:bg-primary-800 dark:bg-primary-600 dark:hover:bg-primary-700",purple:"text-white bg-purple-700 hover:bg-purple-800 dark:bg-purple-600 dark:hover:bg-purple-700",red:"text-white bg-red-700 hover:bg-red-800 dark:bg-red-600 dark:hover:bg-red-700",yellow:"text-white bg-yellow-400 hover:bg-yellow-500 ",none:""},E={alternative:"focus:ring-gray-200 dark:focus:ring-gray-700",blue:"focus:ring-blue-300 dark:focus:ring-blue-800",dark:"focus:ring-gray-300 dark:focus:ring-gray-700",green:"focus:ring-green-300 dark:focus:ring-green-800",light:"focus:ring-gray-200 dark:focus:ring-gray-700",primary:"focus:ring-primary-300 dark:focus:ring-primary-800",purple:"focus:ring-purple-300 dark:focus:ring-purple-900",red:"focus:ring-red-300 dark:focus:ring-red-900",yellow:"focus:ring-yellow-300 dark:focus:ring-yellow-900",none:""},w={alternative:"shadow-gray-500/50 dark:shadow-gray-800/80",blue:"shadow-blue-500/50 dark:shadow-blue-800/80",dark:"shadow-gray-500/50 dark:shadow-gray-800/80",green:"shadow-green-500/50 dark:shadow-green-800/80",light:"shadow-gray-500/50 dark:shadow-gray-800/80",primary:"shadow-primary-500/50 dark:shadow-primary-800/80",purple:"shadow-purple-500/50 dark:shadow-purple-800/80",red:"shadow-red-500/50 dark:shadow-red-800/80 ",yellow:"shadow-yellow-500/50 dark:shadow-yellow-800/80 ",none:""},R={alternative:"text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus:bg-gray-900 focus:text-white focus:ring-gray-300 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-800",blue:"text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-600",dark:"text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus:bg-gray-900 focus:text-white dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-600",green:"text-green-700 hover:text-white border border-green-700 hover:bg-green-800 dark:border-green-500 dark:text-green-500 dark:hover:text-white dark:hover:bg-green-600",light:"text-gray-500 hover:text-gray-900 bg-white border border-gray-200 dark:border-gray-600 dark:hover:text-white dark:text-gray-400 hover:bg-gray-50 dark:bg-gray-700 dark:hover:bg-gray-600",primary:"text-primary-700 hover:text-white border border-primary-700 hover:bg-primary-700 dark:border-primary-500 dark:text-primary-500 dark:hover:text-white dark:hover:bg-primary-600",purple:"text-purple-700 hover:text-white border border-purple-700 hover:bg-purple-800 dark:border-purple-400 dark:text-purple-400 dark:hover:text-white dark:hover:bg-purple-500",red:"text-red-700 hover:text-white border border-red-700 hover:bg-red-800 dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600",yellow:"text-yellow-400 hover:text-white border border-yellow-400 hover:bg-yellow-500 dark:border-yellow-300 dark:text-yellow-300 dark:hover:text-white dark:hover:bg-yellow-400",none:""},W={xs:"px-3 py-2 text-xs",sm:"px-4 py-2 text-sm",md:"px-5 py-2.5 text-sm",lg:"px-5 py-3 text-base",xl:"px-6 py-3.5 text-base"},J=()=>v||y==="alternative"||y==="light";let U;function Z(b){H.call(this,t,b)}function B(b){H.call(this,t,b)}function L(b){H.call(this,t,b)}function z(b){H.call(this,t,b)}function A(b){H.call(this,t,b)}function V(b){H.call(this,t,b)}function M(b){H.call(this,t,b)}function O(b){H.call(this,t,b)}function ne(b){H.call(this,t,b)}return t.$$set=b=>{r(27,e=Re(Re({},e),mt(b))),r(3,a=dt(e,i)),"pill"in b&&r(4,m=b.pill),"outline"in b&&r(5,v=b.outline),"size"in b&&r(6,g=b.size),"href"in b&&r(0,c=b.href),"type"in b&&r(1,h=b.type),"color"in b&&r(7,y=b.color),"shadow"in b&&r(8,T=b.shadow),"$$scope"in b&&r(9,o=b.$$scope)},t.$$.update=()=>{r(2,U=Br("text-center font-medium",d?"focus:ring-2":"focus:ring-4",d&&"focus:z-10",d||"focus:outline-none","inline-flex items-center justify-center "+W[g],v?R[y]:C[y],y==="alternative"&&(d?"dark:bg-gray-700 dark:text-white dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-600":"dark:bg-transparent dark:border-gray-600 dark:hover:border-gray-700"),v&&y==="dark"&&(d?"dark:text-white dark:border-white":"dark:text-gray-400 dark:border-gray-700"),E[y],J()&&d&&"border-l-0 first:border-l",d?m&&"first:rounded-l-full last:rounded-r-full"||"first:rounded-l-lg last:rounded-r-lg":m&&"rounded-full"||"rounded-lg",T&&"shadow-lg",T&&w[y],e.disabled&&"cursor-not-allowed opacity-50",e.class))},e=mt(e),[c,h,U,a,m,v,g,y,T,o,l,Z,B,L,z,A,V,M,O,ne]}class Un extends Or{constructor(e){super(),Fr(this,e,Lr,Zr,Ft,{pill:4,outline:5,size:6,href:0,type:1,color:7,shadow:8})}}const Ne={defaultFullscreen:!1,displayOCR:!0,textEditable:!1,textBoxBorders:!1,boldFont:!1,pageNum:!0,charCount:!1,mobile:!1,bounds:!1,backgroundColor:"#030712",swipeThreshold:50,edgeButtonWidth:40,showTimer:!1,quickActions:!0,fontSize:"auto",zoomDefault:"zoomFitToScreen",invertColors:!1,volumeDefaults:{singlePageView:!1,rightToLeft:!0,hasCover:!1},ankiConnectSettings:{enabled:!1,cropImage:!1,grabSentence:!1,overwriteImage:!0,pictureField:"Picture",sentenceField:"Sentence",heightField:200,widthField:200,qualityField:.5,triggerMethod:"both"}},qr={Default:Ne},ht=window.localStorage.getItem("profiles"),Wr=ht&&Pt?JSON.parse(ht):qr,q=se(Wr),Vr=window.localStorage.getItem("currentProfile")||"Default",_=se(Vr);q.subscribe(t=>{window.localStorage.setItem("profiles",JSON.stringify(t))});_.subscribe(t=>{window.localStorage.setItem("currentProfile",t)});const Ze=K([q,_],([t,e])=>t[e]);function Yr(t,e){q.update(r=>({...r,[F(_)]:{...r[F(_)],[t]:e}}))}function Gn(t,e){q.update(r=>({...r,[F(_)]:{...r[F(_)],volumeDefaults:{...r[F(_)].volumeDefaults,[t]:e}}}))}function Xn(t,e){q.update(r=>({...r,[F(_)]:{...r[F(_)],ankiConnectSettings:{...r[F(_)].ankiConnectSettings,[t]:e}}}))}function Qn(){q.update(t=>({...t,[F(_)]:Ne}))}function $n(t){q.update(e=>({...e,[t]:Ne}))}function eo(t){F(_)===t&&_.set("Default"),q.update(e=>(delete e[t],e))}function to(t,e){F(_)===t&&_.set("Default"),q.update(r=>(delete Object.assign(r,{[e]:r[t]})[t],r))}function ro(t,e){q.update(r=>({...r,[e]:{...r[t]}}))}function no(t){_.set(t)}function jr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ke={exports:{}};ke.exports=Nt;ke.exports.addWheelListener=Nt;ke.exports.removeWheelListener=Hr;function Nt(t,e,r){t.addEventListener("wheel",e,r)}function Hr(t,e,r){t.removeEventListener("wheel",e,r)}var Kr=ke.exports,Se={exports:{}},Jr=4,Ur=.001,Gr=1e-7,Xr=10,le=11,be=1/(le-1),Qr=typeof Float32Array=="function";function Zt(t,e){return 1-3*e+3*t}function Lt(t,e){return 3*e-6*t}function qt(t){return 3*t}function xe(t,e,r){return((Zt(e,r)*t+Lt(e,r))*t+qt(e))*t}function Wt(t,e,r){return 3*Zt(e,r)*t*t+2*Lt(e,r)*t+qt(e)}function $r(t,e,r,i,a){var l,o,d=0;do o=e+(r-e)/2,l=xe(o,i,a)-t,l>0?r=o:e=o;while(Math.abs(l)>Gr&&++d<Xr);return o}function en(t,e,r,i){for(var a=0;a<Jr;++a){var l=Wt(e,r,i);if(l===0)return e;var o=xe(e,r,i)-t;e-=o/l}return e}function tn(t){return t}var rn=function(e,r,i,a){if(!(0<=e&&e<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===r&&i===a)return tn;for(var l=Qr?new Float32Array(le):new Array(le),o=0;o<le;++o)l[o]=xe(o*be,e,i);function d(m){for(var v=0,g=1,c=le-1;g!==c&&l[g]<=m;++g)v+=be;--g;var h=(m-l[g])/(l[g+1]-l[g]),y=v+h*be,T=Wt(y,e,i);return T>=Ur?en(m,y,e,i):T===0?y:$r(m,v,v+be,e,i)}return function(v){return v===0?0:v===1?1:xe(d(v),r,a)}},ue=rn,vt={ease:ue(.25,.1,.25,1),easeIn:ue(.42,0,1,1),easeOut:ue(0,0,.58,1),easeInOut:ue(.42,0,.58,1),linear:ue(0,0,1,1)};Se.exports=nn;Se.exports.makeAggregateRaf=Vt;Se.exports.sharedScheduler=Vt();function nn(t,e,r){var i=Object.create(null),a=Object.create(null);r=r||{};var l=typeof r.easing=="function"?r.easing:vt[r.easing];l||(r.easing&&console.warn("Unknown easing function in amator: "+r.easing),l=vt.ease);var o=typeof r.step=="function"?r.step:yt,d=typeof r.done=="function"?r.done:yt,m=on(r.scheduler),v=Object.keys(e);v.forEach(function(w){i[w]=t[w],a[w]=e[w]-t[w]});var g=typeof r.duration=="number"?r.duration:400,c=Math.max(1,g*.06),h,y=0;return h=m.next(C),{cancel:T};function T(){m.cancel(h),h=0}function C(){var w=l(y/c);y+=1,E(w),y<=c?(h=m.next(C),o(t)):(h=0,setTimeout(function(){d(t)},0))}function E(w){v.forEach(function(R){t[R]=a[R]*w+i[R]})}}function yt(){}function on(t){if(!t){var e=typeof window<"u"&&window.requestAnimationFrame;return e?an():un()}if(typeof t.next!="function")throw new Error("Scheduler is supposed to have next(cb) function");if(typeof t.cancel!="function")throw new Error("Scheduler is supposed to have cancel(handle) function");return t}function an(){return{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}}function un(){return{next:function(t){return setTimeout(t,1e3/60)},cancel:function(t){return clearTimeout(t)}}}function Vt(){var t=new Set,e=new Set,r=0;return{next:a,cancel:a,clearAll:i};function i(){t.clear(),e.clear(),cancelAnimationFrame(r),r=0}function a(d){e.add(d),l()}function l(){r||(r=requestAnimationFrame(o))}function o(){r=0;var d=e;e=t,t=d,t.forEach(function(m){m()}),t.clear()}}var ln=Se.exports,sn=function(e){fn(e);var r=cn(e);return e.on=r.on,e.off=r.off,e.fire=r.fire,e};function cn(t){var e=Object.create(null);return{on:function(r,i,a){if(typeof i!="function")throw new Error("callback is expected to be a function");var l=e[r];return l||(l=e[r]=[]),l.push({callback:i,ctx:a}),t},off:function(r,i){var a=typeof r>"u";if(a)return e=Object.create(null),t;if(e[r]){var l=typeof i!="function";if(l)delete e[r];else for(var o=e[r],d=0;d<o.length;++d)o[d].callback===i&&o.splice(d,1)}return t},fire:function(r){var i=e[r];if(!i)return t;var a;arguments.length>1&&(a=Array.prototype.splice.call(arguments,1));for(var l=0;l<i.length;++l){var o=i[l];o.callback.apply(o.ctx,a)}return t}}}function fn(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],r=0;r<e.length;++r)if(t.hasOwnProperty(e[r]))throw new Error("Subject cannot be eventified, since it already has property '"+e[r]+"'")}var dn=mn;function mn(t,e,r){typeof r!="object"&&(r={});var i=typeof r.minVelocity=="number"?r.minVelocity:5,a=typeof r.amplitude=="number"?r.amplitude:.25,l=typeof r.cancelAnimationFrame=="function"?r.cancelAnimationFrame:gn(),o=typeof r.requestAnimationFrame=="function"?r.requestAnimationFrame:hn(),d,m,v=342,g,c,h,y,T,C,E,w;return{start:W,stop:U,cancel:R};function R(){l(g),l(w)}function W(){d=t(),y=E=c=T=0,m=new Date,l(g),l(w),g=o(J)}function J(){var B=Date.now(),L=B-m;m=B;var z=t(),A=z.x-d.x,V=z.y-d.y;d=z;var M=1e3/(1+L);c=.8*A*M+.2*c,T=.8*V*M+.2*T,g=o(J)}function U(){l(g),l(w);var B=t();h=B.x,C=B.y,m=Date.now(),(c<-i||c>i)&&(y=a*c,h+=y),(T<-i||T>i)&&(E=a*T,C+=E),w=o(Z)}function Z(){var B=Date.now()-m,L=!1,z=0,A=0;y&&(z=-y*Math.exp(-B/v),z>.5||z<-.5?L=!0:z=y=0),E&&(A=-E*Math.exp(-B/v),A>.5||A<-.5?L=!0:A=E=0),L&&(e(h+z,C+A),w=o(Z))}}function gn(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function hn(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(t){return setTimeout(t,16)}}var vn=yn;function yn(t){if(t)return{capture:pt,release:pt};var e,r,i,a=!1;return{capture:l,release:o};function l(d){a=!0,r=window.document.onselectstart,i=window.document.ondragstart,window.document.onselectstart=bt,e=d,e.ondragstart=bt}function o(){a&&(a=!1,window.document.onselectstart=r,e&&(e.ondragstart=i))}}function bt(t){return t.stopPropagation(),!1}function pt(){}var Oe,wt;function bn(){if(wt)return Oe;wt=1,Oe=t;function t(){this.x=0,this.y=0,this.scale=1}return Oe}var pe={exports:{}},xt;function pn(){if(xt)return pe.exports;xt=1,pe.exports=t,pe.exports.canAttach=e;function t(r,i){if(!e(r))throw new Error("svg element is required for svg.panzoom to work");var a=r.ownerSVGElement;if(!a)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");i.disableKeyboardInteraction||a.setAttribute("tabindex",0);var l={getBBox:d,getScreenCTM:m,getOwner:o,applyTransform:g,initTransform:v};return l;function o(){return a}function d(){var c=r.getBBox();return{left:c.x,top:c.y,width:c.width,height:c.height}}function m(){var c=a.getCTM();return c||a.getScreenCTM()}function v(c){var h=r.getCTM();h===null&&(h=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),c.x=h.e,c.y=h.f,c.scale=h.a,a.removeAttributeNS(null,"viewBox")}function g(c){r.setAttribute("transform","matrix("+c.scale+" 0 0 "+c.scale+" "+c.x+" "+c.y+")")}}function e(r){return r&&r.ownerSVGElement&&r.getCTM}return pe.exports}var we={exports:{}},kt;function wn(){if(kt)return we.exports;kt=1,we.exports=t,we.exports.canAttach=e;function t(r,i){var a=e(r);if(!a)throw new Error("panzoom requires DOM element to be attached to the DOM tree");var l=r.parentElement;r.scrollTop=0,i.disableKeyboardInteraction||l.setAttribute("tabindex",0);var o={getBBox:m,getOwner:d,applyTransform:v};return o;function d(){return l}function m(){return{left:0,top:0,width:r.clientWidth,height:r.clientHeight}}function v(g){r.style.transformOrigin="0 0 0",r.style.transform="matrix("+g.scale+", 0, 0, "+g.scale+", "+g.x+", "+g.y+")"}}function e(r){return r&&r.parentElement&&r.style}return we.exports}var St=Kr,Fe=ln,xn=sn,kn=dn,Yt=vn,Sn=Yt(),Tn=Yt(!0),Cn=bn(),Tt=pn(),Ct=wn(),En=1,Mn=1.75,Et=300,Mt=200,Dn=jt;function jt(t,e){e=e||{};var r=e.controller;if(r||(Tt.canAttach(t)?r=Tt(t,e):Ct.canAttach(t)&&(r=Ct(t,e))),!r)throw new Error("Cannot create panzoom for the current type of dom element");var i=r.getOwner(),a={x:0,y:0},l=!1,o=new Cn;r.initTransform&&r.initTransform(o);var d=typeof e.filterKey=="function"?e.filterKey:re,m=typeof e.pinchSpeed=="number"?e.pinchSpeed:1,v=e.bounds,g=typeof e.maxZoom=="number"?e.maxZoom:Number.POSITIVE_INFINITY,c=typeof e.minZoom=="number"?e.minZoom:0,h=typeof e.boundsPadding=="number"?e.boundsPadding:.05,y=typeof e.zoomDoubleClickSpeed=="number"?e.zoomDoubleClickSpeed:Mn,T=e.beforeWheel||re,C=e.beforeMouseDown||re,E=typeof e.zoomSpeed=="number"?e.zoomSpeed:En,w=Dt(e.transformOrigin),R=e.enableTextSelection?Tn:Sn;_n(v),e.autocenter&&Qt();var W,J=0,U=0,Z=0,B=null,L=new Date,z,A=!1,V=!1,M,O,ne,b,Ce,P;"smoothScroll"in e&&!e.smoothScroll?P=zn():P=kn(lr,mr,e.smoothScroll);var Ee,oe,ce,fe=!1;He();var de={dispose:gr,moveBy:Q,moveTo:Me,smoothMoveTo:dr,centerOn:fr,zoomTo:ve,zoomAbs:me,smoothZoom:he,smoothZoomAbs:xr,showRectangle:Xt,pause:Jt,resume:Ut,isPaused:Gt,getTransform:$t,getMinZoom:er,setMinZoom:tr,getMaxZoom:rr,setMaxZoom:nr,getTransformOrigin:or,setTransformOrigin:ar,getZoomSpeed:ir,setZoomSpeed:ur};xn(de);var Le=typeof e.initialX=="number"?e.initialX:o.x,qe=typeof e.initialY=="number"?e.initialY:o.y,We=typeof e.initialZoom=="number"?e.initialZoom:o.scale;return(Le!=o.x||qe!=o.y||We!=o.scale)&&me(Le,qe,We),de;function Jt(){Ke(),fe=!0}function Ut(){fe&&(He(),fe=!1)}function Gt(){return fe}function Xt(n){var u=i.getBoundingClientRect(),s=G(u.width,u.height),f=n.right-n.left,p=n.bottom-n.top;if(!Number.isFinite(f)||!Number.isFinite(p))throw new Error("Invalid rectangle");var x=s.x/f,k=s.y/p,D=Math.min(x,k);o.x=-(n.left+f/2)*D+s.x/2,o.y=-(n.top+p/2)*D+s.y/2,o.scale=D}function G(n,u){if(r.getScreenCTM){var s=r.getScreenCTM(),f=s.a,p=s.d,x=s.e,k=s.f;a.x=n*f-x,a.y=u*p-k}else a.x=n,a.y=u;return a}function Qt(){var n,u,s=0,f=0,p=Ye();if(p)s=p.left,f=p.top,n=p.right-p.left,u=p.bottom-p.top;else{var x=i.getBoundingClientRect();n=x.width,u=x.height}var k=r.getBBox();if(!(k.width===0||k.height===0)){var D=u/k.height,ee=n/k.width,X=Math.min(ee,D);o.x=-(k.left+k.width/2)*X+n/2+s,o.y=-(k.top+k.height/2)*X+u/2+f,o.scale=X}}function $t(){return o}function er(){return c}function tr(n){c=n}function rr(){return g}function nr(n){g=n}function or(){return w}function ar(n){w=Dt(n)}function ir(){return E}function ur(n){if(!Number.isFinite(n))throw new Error("Zoom speed should be a number");E=n}function lr(){return{x:o.x,y:o.y}}function Me(n,u){o.x=n,o.y=u,De(),$("pan"),_e()}function Ve(n,u){Me(o.x+n,o.y+u)}function De(){var n=Ye();if(n){var u=!1,s=sr(),f=n.left-s.right;return f>0&&(o.x+=f,u=!0),f=n.right-s.left,f<0&&(o.x+=f,u=!0),f=n.top-s.bottom,f>0&&(o.y+=f,u=!0),f=n.bottom-s.top,f<0&&(o.y+=f,u=!0),u}}function Ye(){if(v){if(typeof v=="boolean"){var n=i.getBoundingClientRect(),u=n.width,s=n.height;return{left:u*h,top:s*h,right:u*(1-h),bottom:s*(1-h)}}return v}}function sr(){var n=r.getBBox(),u=cr(n.left,n.top);return{left:u.x,top:u.y,right:n.width*o.scale+u.x,bottom:n.height*o.scale+u.y}}function cr(n,u){return{x:n*o.scale+o.x,y:u*o.scale+o.y}}function _e(){l=!0,W=window.requestAnimationFrame(hr)}function je(n,u,s){if(Be(n)||Be(u)||Be(s))throw new Error("zoom requires valid numbers");var f=o.scale*s;if(f<c){if(o.scale===c)return;s=c/o.scale}if(f>g){if(o.scale===g)return;s=g/o.scale}var p=G(n,u);if(o.x=p.x-s*(p.x-o.x),o.y=p.y-s*(p.y-o.y),v&&h===1&&c===1)o.scale*=s,De();else{var x=De();x||(o.scale*=s)}$("zoom"),_e()}function me(n,u,s){var f=s/o.scale;je(n,u,f)}function fr(n){var u=n.ownerSVGElement;if(!u)throw new Error("ui element is required to be within the scene");var s=n.getBoundingClientRect(),f=s.left+s.width/2,p=s.top+s.height/2,x=u.getBoundingClientRect(),k=x.width/2-f,D=x.height/2-p;Q(k,D,!0)}function dr(n,u){Q(n-o.x,u-o.y,!0)}function Q(n,u,s){if(!s)return Ve(n,u);Ee&&Ee.cancel();var f={x:0,y:0},p={x:n,y:u},x=0,k=0;Ee=Fe(f,p,{step:function(D){Ve(D.x-x,D.y-k),x=D.x,k=D.y}})}function mr(n,u){ye(),Me(n,u)}function gr(){Ke()}function He(){i.addEventListener("mousedown",tt,{passive:!1}),i.addEventListener("dblclick",et,{passive:!1}),i.addEventListener("touchstart",Ue,{passive:!1}),i.addEventListener("keydown",Je,{passive:!1}),St.addWheelListener(i,it,{passive:!1}),_e()}function Ke(){St.removeWheelListener(i,it),i.removeEventListener("mousedown",tt),i.removeEventListener("keydown",Je),i.removeEventListener("dblclick",et),i.removeEventListener("touchstart",Ue),W&&(window.cancelAnimationFrame(W),W=0),P.cancel(),ot(),at(),R.release(),ze()}function hr(){l&&vr()}function vr(){l=!1,r.applyTransform(o),$("transform"),W=0}function Je(n){var u=0,s=0,f=0;if(n.keyCode===38?s=1:n.keyCode===40?s=-1:n.keyCode===37?u=1:n.keyCode===39?u=-1:n.keyCode===189||n.keyCode===109?f=1:(n.keyCode===187||n.keyCode===107)&&(f=-1),!d(n,u,s,f)){if(u||s){n.preventDefault(),n.stopPropagation();var p=i.getBoundingClientRect(),x=Math.min(p.width,p.height),k=.05,D=x*k*u,ee=x*k*s;Q(D,ee)}if(f){var X=ut(f*100),x=w?ie():yr();ve(x.x,x.y,X)}}}function yr(){var n=i.getBoundingClientRect();return{x:n.width/2,y:n.height/2}}function Ue(n){if(br(n),ae(),n.touches.length===1)return wr(n,n.touches[0]);n.touches.length===2&&(Ce=$e(n.touches[0],n.touches[1]),ce=!0,Ge())}function br(n){e.onTouch&&!e.onTouch(n)||(n.stopPropagation(),n.preventDefault())}function pr(n){ae(),!(e.onDoubleClick&&!e.onDoubleClick(n))&&(n.preventDefault(),n.stopPropagation())}function wr(n){U=new Date;var u=n.touches[0],s=Y(u);z=s;var f=G(s.x,s.y);M=f.x,O=f.y,ne=M,b=O,P.cancel(),Ge()}function Ge(){A||(A=!0,document.addEventListener("touchmove",Xe),document.addEventListener("touchend",ge),document.addEventListener("touchcancel",ge))}function Xe(n){if(n.touches.length===1){n.stopPropagation();var u=n.touches[0],s=Y(u),f=G(s.x,s.y),p=f.x-M,x=f.y-O;p!==0&&x!==0&&lt(),M=f.x,O=f.y,Q(p,x)}else if(n.touches.length===2){ce=!0;var k=n.touches[0],D=n.touches[1],ee=$e(k,D),X=1+(ee/Ce-1)*m,st=Y(k),ct=Y(D);if(M=(st.x+ct.x)/2,O=(st.y+ct.y)/2,w){var s=ie();M=s.x,O=s.y}ve(M,O,X),Ce=ee,n.stopPropagation(),n.preventDefault()}}function ae(){Z&&(clearTimeout(Z),Z=0)}function Qe(n){if(e.onClick){ae();var u=M-ne,s=O-b,f=Math.sqrt(u*u+s*s);f>5||(Z=setTimeout(function(){Z=0,e.onClick(n)},Et))}}function ge(n){if(ae(),n.touches.length>0){var u=Y(n.touches[0]),s=G(u.x,u.y);M=s.x,O=s.y}else{var f=new Date;if(f-J<Et)if(w){var u=ie();he(u.x,u.y,y)}else he(z.x,z.y,y);else f-U<Mt&&Qe(n);J=f,ze(),at()}}function $e(n,u){var s=n.clientX-u.clientX,f=n.clientY-u.clientY;return Math.sqrt(s*s+f*f)}function et(n){pr(n);var u=Y(n);w&&(u=ie()),he(u.x,u.y,y)}function tt(n){if(ae(),!C(n)){if(B=n,L=new Date,A)return n.stopPropagation(),!1;var u=n.button===1&&window.event!==null||n.button===0;if(u){P.cancel();var s=Y(n),f=G(s.x,s.y);return ne=M=f.x,b=O=f.y,document.addEventListener("mousemove",rt),document.addEventListener("mouseup",nt),R.capture(n.target||n.srcElement),!1}}}function rt(n){if(!A){lt();var u=Y(n),s=G(u.x,u.y),f=s.x-M,p=s.y-O;M=s.x,O=s.y,Q(f,p)}}function nt(){var n=new Date;n-L<Mt&&Qe(B),R.release(),ze(),ot()}function ot(){document.removeEventListener("mousemove",rt),document.removeEventListener("mouseup",nt),V=!1}function at(){document.removeEventListener("touchmove",Xe),document.removeEventListener("touchend",ge),document.removeEventListener("touchcancel",ge),V=!1,ce=!1,A=!1}function it(n){if(!T(n)){P.cancel();var u=n.deltaY;n.deltaMode>0&&(u*=100);var s=ut(u);if(s!==1){var f=w?ie():Y(n);ve(f.x,f.y,s),n.preventDefault()}}}function Y(n){var u,s,f=i.getBoundingClientRect();return u=n.clientX-f.left,s=n.clientY-f.top,{x:u,y:s}}function he(n,u,s){var f=o.scale,p={scale:f},x={scale:s*f};P.cancel(),ye(),oe=Fe(p,x,{step:function(k){me(n,u,k.scale)},done:kr})}function xr(n,u,s){var f=o.scale,p={scale:f},x={scale:s};P.cancel(),ye(),oe=Fe(p,x,{step:function(k){me(n,u,k.scale)}})}function ie(){var n=i.getBoundingClientRect();return{x:n.width*w.x,y:n.height*w.y}}function ve(n,u,s){return P.cancel(),ye(),je(n,u,s)}function ye(){oe&&(oe.cancel(),oe=null)}function ut(n){var u=Math.sign(n),s=Math.min(.25,Math.abs(E*n/128));return 1-u*s}function lt(){V||($("panstart"),V=!0,P.start())}function ze(){V&&(ce||P.stop(),$("panend"))}function kr(){$("zoomend")}function $(n){de.fire(n,de)}}function Dt(t){if(t){if(typeof t=="object")return(!te(t.x)||!te(t.y))&&_t(t),t;_t()}}function _t(t){throw console.error(t),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function re(){}function _n(t){var e=typeof t;if(!(e==="undefined"||e==="boolean")){var r=te(t.left)&&te(t.top)&&te(t.bottom)&&te(t.right);if(!r)throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}}function te(t){return Number.isFinite(t)}function Be(t){return Number.isNaN?Number.isNaN(t):t!==t}function zn(){return{start:re,stop:re,cancel:re}}function An(){if(typeof document>"u")return;var t=document.getElementsByTagName("script");if(!t)return;for(var e,r=0;r<t.length;++r){var i=t[r];if(i.src&&i.src.match(/\bpanzoom(\.min)?\.js/)){e=i;break}}if(!e)return;var a=e.getAttribute("query");if(!a)return;var l=e.getAttribute("name")||"pz",o=Date.now();d();function d(){var g=document.querySelector(a);if(!g){var c=Date.now(),h=c-o;if(h<2e3){setTimeout(d,100);return}console.error("Cannot find the panzoom element",l);return}var y=m(e);console.log(y),window[l]=jt(g,y)}function m(g){for(var c=g.attributes,h={},y=0;y<c.length;++y){var T=c[y],C=v(T);C&&(h[C.name]=C.value)}return h}function v(g){if(g.name){var c=g.name[0]==="p"&&g.name[1]==="z"&&g.name[2]==="-";if(c){var h=g.name.substr(3),y=JSON.parse(g.value);return{name:h,value:y}}}}}An();const On=jr(Dn);let S,N;const Fn=se(void 0);function oo(t){N=t,S=On(t,{bounds:!1,maxZoom:10,minZoom:.1,zoomDoubleClickSpeed:1,enableTextSelection:!0,beforeMouseDown:e=>e.target.nodeName==="P",beforeWheel:e=>e.altKey,onTouch:e=>e.touches.length>1,filterKey:e=>{if(e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"||e.key==="ArrowDown")return!0}}),Fn.set(S),S.on("pan",()=>zt()),S.on("zoom",()=>zt())}function Te(t,e){if(!S||!N)return;const{scale:r}=S.getTransform(),{innerWidth:i,innerHeight:a}=window,{offsetWidth:l,offsetHeight:o}=N;let d=0,m=0;switch(t){case"left":d=0;break;case"center":d=(i-l*r)/2;break;case"right":d=i-l*r;break}switch(e){case"top":m=0;break;case"center":m=(a-o*r)/2;break;case"bottom":m=a-o*r;break}S.pause(),S.moveTo(d,m),S.resume()}function Bn(){S==null||S.moveTo(0,0),S==null||S.zoomTo(0,0,1/S.getTransform().scale),Te("center","center")}function In(){if(!S||!N)return;const{innerWidth:t}=window,e=1/S.getTransform().scale*(t/N.offsetWidth);S.moveTo(0,0),S.zoomTo(0,0,e),Te("center","top")}function Rn(){if(!S||!N)return;const{innerWidth:t,innerHeight:e}=window,r=t/N.offsetWidth,i=e/N.offsetHeight,a=1/S.getTransform().scale*Math.min(r,i);S.moveTo(0,0),S.zoomTo(0,0,a),Te("center","center")}function Pn(){Te("center","top")}function Nn(){switch(F(Ze).zoomDefault){case"zoomFitToScreen":Rn();return;case"zoomFitToWidth":In();return;case"zoomOriginal":Bn();return;case"keepZoomStart":Pn();return}}function zt(){if(!S||!N)return;const{mobile:t,bounds:e}=F(Ze);if(!t&&!e)return;const r=S.getTransform(),{x:i,y:a,scale:l}=r,{innerWidth:o,innerHeight:d}=window,m=N.offsetWidth*l,v=N.offsetHeight*l,g=o*.001,c=d*.01;let h=o-m-g,y=g,T=d-v-c,C=c,E=!1;m+2*g<=o?(h=g,y=o-m-g):(h=o-m-g,y=g),v+2*c<=d?(T=c,C=d-v-c,E=!0):(T=d-v-c,C=c),i<h&&(r.x=h),i>y&&(r.x=y),E?r.y=d/2-v/2:(a<T&&(r.y=T),a>C&&(r.y=C))}function ao(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}const Zn=Rr(()=>Pr.catalog.toArray());function Ln(t,e){return t.volumeName<e.volumeName?-1:t.volumeName>e.volumeName?1:0}const Ht=K([Pe,Zn],([t,e])=>{var r;if(t&&e)return(r=e.find(i=>i.id===t.params.manga))==null?void 0:r.manga.sort(Ln)}),qn=K([Pe,Ht],([t,e])=>{if(t&&e)return e.find(r=>r.mokuroData.volume_uuid===t.params.volume)}),At=window.localStorage.getItem("volumes"),Wn=At&&Pt?JSON.parse(At):{},I=se(Wn);function io(t){const e=F(Ze).volumeDefaults;e||Yr("volumeDefaults",{singlePageView:!1,rightToLeft:!0,hasCover:!1});const{hasCover:r,rightToLeft:i,singlePageView:a}=e;I.update(l=>({...l,[t]:{chars:0,completed:!1,progress:0,timeReadInMinutes:0,settings:{hasCover:r,rightToLeft:i,singlePageView:a}}}))}function uo(t){I.update(e=>(delete e[t],e))}function lo(){I.set({})}function so(t,e,r,i=!1){I.update(a=>({...a,[t]:{...a==null?void 0:a[t],progress:e,chars:r||(a==null?void 0:a[t].chars),completed:i}}))}function co(t){return setInterval(()=>{I.update(e=>({...e,[t]:{...e==null?void 0:e[t],timeReadInMinutes:(e==null?void 0:e[t].timeReadInMinutes)+1}}))},60*1e3)}I.subscribe(t=>{window.localStorage.setItem("volumes",t?JSON.stringify(t):"")});const fo=K(I,t=>{const e={};return t&&Object.keys(t).forEach(r=>{e[r]=t[r].progress}),e}),mo=K(I,t=>{const e={};return t&&Object.keys(t).forEach(r=>{e[r]=t[r].settings}),e});function go(t,e,r){I.update(i=>({...i,[t]:{...i[t],settings:{...i[t].settings,[e]:r}}})),Nn()}const ho=K([I,Pe],([t,e])=>{if(e&&t)return Object.values(t).reduce((r,{chars:i,completed:a,timeReadInMinutes:l,progress:o})=>(a&&r.completed++,r.pagesRead+=o,r.minutesRead+=l,r.charsRead+=i,r),{charsRead:0,completed:0,pagesRead:0,minutesRead:0})}),vo=K([Ht,I],([t,e])=>{if(t&&e)return t.map(r=>r.mokuroData.volume_uuid).reduce((r,i)=>{var d,m,v;const a=((d=e[i])==null?void 0:d.timeReadInMinutes)||0,l=((m=e[i])==null?void 0:m.chars)||0,o=((v=e[i])==null?void 0:v.completed)||0;return r.timeReadInMinutes=r.timeReadInMinutes+a,r.chars=r.chars+l,r.completed=r.completed+o,r},{timeReadInMinutes:0,chars:0,completed:0})}),yo=K([qn,I],([t,e])=>{if(t&&e){const{chars:r,completed:i,timeReadInMinutes:a,progress:l}=e[t.mokuroData.volume_uuid];return{chars:r,completed:i,timeReadInMinutes:a,progress:l}}}),Vn={galleryLayout:"grid",gallerySorting:"ASC"},Ot=window.localStorage.getItem("miscSettings"),Kt=se(Ot?JSON.parse(Ot):Vn);Kt.subscribe(t=>{window.localStorage.setItem("miscSettings",JSON.stringify(t))});function bo(t,e){Kt.update(r=>({...r,[t]:e}))}export{no as A,Un as B,lo as C,ho as D,Gn as E,go as F,Qn as G,fo as a,vo as b,Zn as c,uo as d,Rn as e,Fn as f,so as g,yo as h,oo as i,co as j,io as k,mo as l,Kt as m,Xn as n,Yr as o,q as p,ro as q,eo as r,Ze as s,ao as t,bo as u,I as v,to as w,$n as x,_ as y,Nn as z};
