import{U as m,Q as S,R as x}from"./index.82e508c7.js";let _=[];const N=[];let y=0;async function ne(t,e){const{options:i,config:s}=e,{transferStreams:a,useWebWorkers:c,useCompressionStream:n,codecType:E,compressed:o,signed:T,encrypted:u}=i,{workerScripts:r,maxWorkers:f,terminateWorkerTimeout:d}=s;e.transferStreams=a||a===m;const W=!o&&!T&&!u&&!e.transferStreams;e.useWebWorkers=!W&&(c||c===m&&s.useWebWorkers),e.scripts=e.useWebWorkers&&r?r[E]:[],i.useCompressionStream=n||n===m&&s.useCompressionStream;let A;const b=_.find(l=>!l.busy);if(b)M(b),A=new S(b,t,e,P);else if(_.length<f){const l={indexWorker:y};y++,_.push(l),A=new S(l,t,e,P)}else A=await new Promise(l=>N.push({resolve:l,stream:t,workerOptions:e}));return A.run();function P(l){if(N.length){const[{resolve:R,stream:C,workerOptions:D}]=N.splice(0,1);R(new S(l,C,D,P))}else l.worker?(M(l),Number.isFinite(d)&&d>=0&&(l.terminateTimeout=setTimeout(()=>{_=_.filter(R=>R!=l),l.terminate()},d))):_=_.filter(R=>R!=l)}}function M(t){const{terminateTimeout:e}=t;e&&(clearTimeout(e),t.terminateTimeout=null)}const I="Writer iterator completed too soon",U="text/plain",Y="Content-Type",g=64*1024,F="writable";class p{constructor(){this.size=0}init(){this.initialized=!0}}class h extends p{get readable(){const e=this,{chunkSize:i=g}=e,s=new ReadableStream({start(){this.chunkOffset=0},async pull(a){const{offset:c=0,size:n,diskNumberStart:E}=s,{chunkOffset:o}=this;a.enqueue(await O(e,c+o,Math.min(i,n-o),E)),o+i>n?a.close():this.chunkOffset+=i}});return s}}class L extends h{constructor(e){super(),Object.assign(this,{blob:e,size:e.size})}async readUint8Array(e,i){const s=this,a=e+i;let n=await(e||a<s.size?s.blob.slice(e,a):s.blob).arrayBuffer();return n.byteLength>i&&(n=n.slice(e,a)),new Uint8Array(n)}}class re extends p{constructor(e){super();const i=this,s=new TransformStream,a=[];e&&a.push([Y,e]),Object.defineProperty(i,F,{get(){return s.writable}}),i.blob=new Response(s.readable,{headers:a}).blob()}getData(){return this.blob}}class oe extends L{constructor(e){super(new Blob([e],{type:U}))}}class ce extends h{constructor(e){super(),Object.assign(this,{array:e,size:e.length})}readUint8Array(e,i){return this.array.slice(e,e+i)}}class k extends h{constructor(e){super(),this.readers=e}async init(){const e=this,{readers:i}=e;e.lastDiskNumber=0,e.lastDiskOffset=0,await Promise.all(i.map(async(s,a)=>{await s.init(),a!=i.length-1&&(e.lastDiskOffset+=s.size),e.size+=s.size})),super.init()}async readUint8Array(e,i,s=0){const a=this,{readers:c}=this;let n,E=s;E==-1&&(E=c.length-1);let o=e;for(;o>=c[E].size;)o-=c[E].size,E++;const T=c[E],u=T.size;if(o+i<=u)n=await O(T,o,i);else{const r=u-o;n=new Uint8Array(i),n.set(await O(T,o,r)),n.set(await a.readUint8Array(e+r,i-r,s),r)}return a.lastDiskNumber=Math.max(E,a.lastDiskNumber),n}}class w extends p{constructor(e,i=4294967295){super();const s=this;Object.assign(s,{diskNumber:0,diskOffset:0,size:0,maxSize:i,availableSize:i});let a,c,n;const E=new WritableStream({async write(u){const{availableSize:r}=s;if(n)u.length>=r?(await o(u.slice(0,r)),await T(),s.diskOffset+=a.size,s.diskNumber++,n=null,await this.write(u.slice(r))):await o(u);else{const{value:f,done:d}=await e.next();if(d&&!f)throw new Error(I);a=f,a.size=0,a.maxSize&&(s.maxSize=a.maxSize),s.availableSize=s.maxSize,await B(a),c=f.writable,n=c.getWriter(),await this.write(u)}},async close(){await n.ready,await T()}});Object.defineProperty(s,F,{get(){return E}});async function o(u){const r=u.length;r&&(await n.ready,await n.write(u),a.size+=r,s.size+=r,s.availableSize-=r)}async function T(){c.size=a.size,await n.close()}}}async function B(t,e){t.init&&!t.initialized&&await t.init(e)}function le(t){return Array.isArray(t)&&(t=new k(t)),t instanceof ReadableStream&&(t={readable:t}),t}function Ee(t){t.writable===m&&typeof t.next==x&&(t=new w(t)),t instanceof WritableStream&&(t={writable:t});const{writable:e}=t;return e.size===m&&(e.size=0),t instanceof w||Object.assign(t,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),t}function O(t,e,i,s){return t.readUint8Array(e,i,s)}const v="filename",j="rawFilename",Z="comment",q="rawComment",H="uncompressedSize",K="compressedSize",X="offset",z="diskNumberStart",Q="lastModDate",V="rawLastModDate",G="lastAccessDate",ue="rawLastAccessDate",J="creationDate",Te="rawCreationDate",$="internalFileAttribute",ee="externalFileAttribute",te="msDosCompatible",se="zip64",ie=[v,j,K,H,Q,V,Z,q,G,J,X,z,z,$,ee,te,se,"directory","bitFlag","encrypted","signature","filenameUTF8","commentUTF8","compressionMethod","version","versionMadeBy","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"];class _e{constructor(e){ie.forEach(i=>this[i]=e[i])}}export{L as B,_e as E,H as P,w as S,oe as T,ce as U,B as a,Ee as b,ne as c,K as d,X as e,z as f,j as g,v as h,le as i,q as j,Z as k,Q as l,G as m,J as n,V as o,ue as p,Te as q,O as r,re as s,te as t,$ as u,ee as v,se as w};
